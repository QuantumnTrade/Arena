# ðŸ—ï¸ SYSTEM ARCHITECTURE - QUANTUM TRADE

## ðŸ“Š **HIGH-LEVEL OVERVIEW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”‚                      (Next.js 16 + React)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE MANAGEMENT LAYER                       â”‚
â”‚                      (Zustand Store)                            â”‚
â”‚  â€¢ Account Balance    â€¢ Positions    â€¢ Assets    â€¢ Status      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ ASTER Sync   â”‚  â”‚ AI Trading   â”‚  â”‚  Supabase    â”‚         â”‚
â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASTER DEX API  â”‚  â”‚   AI/ML APIs    â”‚  â”‚   Supabase DB   â”‚
â”‚   (V2 - HMAC)   â”‚  â”‚  (AIML, etc.)   â”‚  â”‚   (PostgreSQL)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ **AUTO-SYNC FLOW (Every 5 Seconds)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Page Load   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useAsterAccountSync  â”‚ â† Hook initialized
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Every 5 seconds:                        â”‚
â”‚  1. Call GET /api/aster-account          â”‚
â”‚  2. Fetch balance from ASTER             â”‚
â”‚  3. Fetch positions from ASTER           â”‚
â”‚  4. Update Zustand store                 â”‚
â”‚  5. UI re-renders automatically          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ¤– **AI TRADING FLOW (Manual Trigger)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User clicks        â”‚
â”‚  "Run AI Analysis"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  executeAITradingForAllAgents()                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  For each agent:                               â”‚ â”‚
â”‚  â”‚  1. Fetch market data (BTC, ETH, SOL, BNB)    â”‚ â”‚
â”‚  â”‚  2. Fetch active positions from Supabase      â”‚ â”‚
â”‚  â”‚  3. Call AI API with context                  â”‚ â”‚
â”‚  â”‚  4. Receive AI decisions                      â”‚ â”‚
â”‚  â”‚  5. Process each decision:                    â”‚ â”‚
â”‚  â”‚     â”œâ”€ LONG â†’ executeLong()                   â”‚ â”‚
â”‚  â”‚     â”œâ”€ SHORT â†’ executeShort()                 â”‚ â”‚
â”‚  â”‚     â”œâ”€ CLOSE â†’ executeClose()                 â”‚ â”‚
â”‚  â”‚     â”œâ”€ HOLD â†’ Keep position                   â”‚ â”‚
â”‚  â”‚     â””â”€ WAIT â†’ Do nothing                      â”‚ â”‚
â”‚  â”‚  6. Save to Supabase                          â”‚ â”‚
â”‚  â”‚  7. Update agent stats                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ˆ **LONG POSITION EXECUTION**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Decision:   â”‚
â”‚  LONG BTC       â”‚
â”‚  Leverage: 10x  â”‚
â”‚  Size: $100     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  executeLong(decision)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Convert coin â†’ ASTER symbol   â”‚ â”‚
â”‚  â”‚     BTC â†’ BTCUSDT                 â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  2. Calculate quantity            â”‚ â”‚
â”‚  â”‚     quantity = size_usd / price   â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  3. Set leverage on ASTER         â”‚ â”‚
â”‚  â”‚     changeInitialLeverage(10x)    â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  4. Place MARKET BUY order        â”‚ â”‚
â”‚  â”‚     marketBuy(BTCUSDT, qty)       â”‚ â”‚
â”‚  â”‚     â†’ Returns order ID            â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  5. Place STOP LOSS order         â”‚ â”‚
â”‚  â”‚     placeStopLoss(stopPrice)      â”‚ â”‚
â”‚  â”‚     â†’ Returns SL order ID         â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  6. Place TAKE PROFIT order       â”‚ â”‚
â”‚  â”‚     placeTakeProfit(tpPrice)      â”‚ â”‚
â”‚  â”‚     â†’ Returns TP order ID         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Save to Supabase                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  positions table:                 â”‚ â”‚
â”‚  â”‚  - agent_id                       â”‚ â”‚
â”‚  â”‚  - symbol: BTC                    â”‚ â”‚
â”‚  â”‚  - side: LONG                     â”‚ â”‚
â”‚  â”‚  - entry_price                    â”‚ â”‚
â”‚  â”‚  - stop_loss                      â”‚ â”‚
â”‚  â”‚  - take_profit                    â”‚ â”‚
â”‚  â”‚  - size_usd: 100                  â”‚ â”‚
â”‚  â”‚  - leverage: 10                   â”‚ â”‚
â”‚  â”‚  - entry_order_id: 12345 âœ…       â”‚ â”‚
â”‚  â”‚  - stop_loss_order_id: 12346 âœ…   â”‚ â”‚
â”‚  â”‚  - take_profit_order_id: 12347 âœ… â”‚ â”‚
â”‚  â”‚  - is_active: true                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”» **SHORT POSITION EXECUTION**

```
Same flow as LONG, but:
- Uses marketSell() instead of marketBuy()
- Stop loss placed ABOVE entry (resistance)
- Take profit placed BELOW entry (support)
```

---

## âŒ **CLOSE POSITION EXECUTION**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Decision:   â”‚
â”‚  CLOSE BTC      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  executeClose(coin)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Get position from ASTER       â”‚ â”‚
â”‚  â”‚     getPositionInfo(BTCUSDT)      â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  2. Detect position side          â”‚ â”‚
â”‚  â”‚     positionAmt > 0 â†’ LONG        â”‚ â”‚
â”‚  â”‚     positionAmt < 0 â†’ SHORT       â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  3. Close at market price         â”‚ â”‚
â”‚  â”‚     closePositionMarket(symbol)   â”‚ â”‚
â”‚  â”‚     â†’ Returns exit price & PnL    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Supabase                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  positions table:                 â”‚ â”‚
â”‚  â”‚  - is_active: false               â”‚ â”‚
â”‚  â”‚  - exit_price                     â”‚ â”‚
â”‚  â”‚  - exit_time                      â”‚ â”‚
â”‚  â”‚  - exit_reason: "AI_DECISION"     â”‚ â”‚
â”‚  â”‚  - pnl_usd (calculated)           â”‚ â”‚
â”‚  â”‚  - pnl_pct (calculated)           â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  agents table:                    â”‚ â”‚
â”‚  â”‚  - balance (updated)              â”‚ â”‚
â”‚  â”‚  - total_pnl (updated)            â”‚ â”‚
â”‚  â”‚  - trade_count (+1)               â”‚ â”‚
â”‚  â”‚  - win_count or loss_count (+1)   â”‚ â”‚
â”‚  â”‚  - win_rate (recalculated)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ—„ï¸ **DATA FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ASTER DEX (Live)                      â”‚
â”‚  â€¢ Account Balance                                       â”‚
â”‚  â€¢ Active Positions                                      â”‚
â”‚  â€¢ Order Execution                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Sync every 5s
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Zustand Store (Client-Side)                 â”‚
â”‚  â€¢ totalBalance                                          â”‚
â”‚  â€¢ availableBalance                                      â”‚
â”‚  â€¢ assets: { BNB, USDT }                                 â”‚
â”‚  â€¢ positions: [...]                                      â”‚
â”‚  â€¢ canTrade                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Save on trade
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Supabase Database (Persistent)                â”‚
â”‚  â€¢ agents (performance metrics)                          â”‚
â”‚  â€¢ positions (trade history)                             â”‚
â”‚  â€¢ agent_summaries (AI decisions)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ” **AUTHENTICATION FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Request    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASTER V2 API (HMAC SHA256)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Build query string            â”‚ â”‚
â”‚  â”‚     timestamp=xxx&symbol=BTC...   â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  2. Generate HMAC signature       â”‚ â”‚
â”‚  â”‚     HMAC-SHA256(queryString,      â”‚ â”‚
â”‚  â”‚                 SECRET_KEY)       â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  3. Append signature              â”‚ â”‚
â”‚  â”‚     ...&signature=abc123          â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  4. Add API key to headers        â”‚ â”‚
â”‚  â”‚     X-MBX-APIKEY: your_key        â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  5. Send request                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“¦ **FILE STRUCTURE**

```
quantum-trade/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ aster-account/      # Auto-sync endpoint
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ai-analysis/        # AI decision endpoint
â”‚   â”‚   â”‚   â””â”€â”€ ticker/             # Market data
â”‚   â”‚   â””â”€â”€ page.tsx                # Main UI
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ AgentsTable.tsx
â”‚   â”‚   â”œâ”€â”€ CompactMarkets.tsx
â”‚   â”‚   â”œâ”€â”€ AccountValueChart.tsx
â”‚   â”‚   â””â”€â”€ AsterAccountWidget.tsx  # Example widget
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ use-aster-account.ts    # Account hooks
â”‚   â”‚   â””â”€â”€ use-aster-sync.ts       # Auto-sync hook
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ aster-client.ts         # ASTER API client
â”‚   â”‚   â”œâ”€â”€ aster-execution-service.ts  # Trade execution
â”‚   â”‚   â”œâ”€â”€ ai-trading-service.ts   # AI trading orchestration
â”‚   â”‚   â”œâ”€â”€ supabase-service.ts     # Database operations
â”‚   â”‚   â””â”€â”€ market-service.ts       # Market data
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ aster-account-service.ts  # Account sync service
â”‚   â”‚
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ aster-store.ts          # Zustand store
â”‚   â”‚
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts                # TypeScript types
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ REAL_TRADING_GUIDE.md       # Complete guide
â”‚   â”œâ”€â”€ ASTER_STATE_MANAGEMENT.md   # State management docs
â”‚   â””â”€â”€ SYSTEM_ARCHITECTURE.md      # This file
â”‚
â”œâ”€â”€ supabase_schema.sql             # Database schema
â”œâ”€â”€ QUICKSTART.md                   # Quick start guide
â””â”€â”€ .env.local                      # Environment variables
```

---

## ðŸ”„ **STATE MANAGEMENT ARCHITECTURE**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Zustand Store                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  State:                                           â”‚ â”‚
â”‚  â”‚  - isConnected: boolean                           â”‚ â”‚
â”‚  â”‚  - totalBalance: number                           â”‚ â”‚
â”‚  â”‚  - availableBalance: number                       â”‚ â”‚
â”‚  â”‚  - canTrade: boolean                              â”‚ â”‚
â”‚  â”‚  - multiAssetsMode: boolean                       â”‚ â”‚
â”‚  â”‚  - assets: Record<string, AsterAsset>            â”‚ â”‚
â”‚  â”‚  - positions: AsterPosition[]                     â”‚ â”‚
â”‚  â”‚  - totalPositions: number                         â”‚ â”‚
â”‚  â”‚  - totalExposure: number                          â”‚ â”‚
â”‚  â”‚  - totalUnrealizedPnl: number                     â”‚ â”‚
â”‚  â”‚  - lastUpdate: number                             â”‚ â”‚
â”‚  â”‚  - error: string | null                           â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  Actions:                                         â”‚ â”‚
â”‚  â”‚  - setAccountData()                               â”‚ â”‚
â”‚  â”‚  - setAssets()                                    â”‚ â”‚
â”‚  â”‚  - setPositions()                                 â”‚ â”‚
â”‚  â”‚  - setConnectionStatus()                          â”‚ â”‚
â”‚  â”‚  - reset()                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Selective subscriptions
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   React Components                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  const balance = useBNBBalance();                 â”‚ â”‚
â”‚  â”‚  const positions = useActivePositions();          â”‚ â”‚
â”‚  â”‚  const canTrade = useCanTrade();                  â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  // Only re-renders when subscribed data changes â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¯ **PERFORMANCE OPTIMIZATIONS**

### **1. Selective Subscriptions**
```typescript
// âœ… GOOD - Only subscribes to totalBalance
const balance = useAsterStore(state => state.totalBalance);

// âŒ BAD - Subscribes to entire store
const store = useAsterStore();
```

### **2. Computed Selectors**
```typescript
export const selectAccountSummary = (state: AsterStore) => ({
  totalBalance: state.totalBalance,
  availableBalance: state.availableBalance,
  // ... computed values
});
```

### **3. Debounced Updates**
- Auto-sync: Every 5 seconds (not every render)
- Market data: Cached with SWR
- Database: Batch updates

---

## ðŸš€ **DEPLOYMENT CHECKLIST**

- [ ] Environment variables configured
- [ ] ASTER API keys valid
- [ ] Supabase database created
- [ ] Schema applied
- [ ] Agents seeded
- [ ] Balance funded
- [ ] Multi-assets mode enabled
- [ ] Test trade executed successfully

---

## ðŸ“Š **MONITORING POINTS**

1. **Client-Side (Browser)**
   - Zustand DevTools
   - Console logs
   - Network tab

2. **Server-Side (API)**
   - API response times
   - Error rates
   - Order execution success rate

3. **Database (Supabase)**
   - Position count
   - Agent performance
   - Trade history

4. **Exchange (ASTER)**
   - Account balance
   - Active orders
   - Position status

---

**System is production-ready for real futures trading! ðŸš€**
